<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.letu.healthplatform.platformmanage.report.mapper.SortMessageMapper">
  <resultMap id="BaseResultMap" type="com.letu.healthplatform.platformmanage.report.model.SortMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    <id column="t_id" jdbcType="INTEGER" property="tId" />
    <result column="t_user_id" jdbcType="INTEGER" property="tUserId" />
    <result column="t_user_name" jdbcType="VARCHAR" property="tUserName" />
    <result column="t_user_sex" jdbcType="VARCHAR" property="tUserSex" />
    <result column="t_user_telphone" jdbcType="VARCHAR" property="tUserTelphone" />
    <result column="t_user_email" jdbcType="VARCHAR" property="tUserEmail" />
    <result column="t_logistics" jdbcType="VARCHAR" property="tLogistics" />
    <result column="t_logistics_number" jdbcType="VARCHAR" property="tLogisticsNumber" />
    <result column="t_batch_id" jdbcType="INTEGER" property="tBatchId" />
    <result column="t_batch_topic" jdbcType="VARCHAR" property="tBatchTopic" />
    <result column="t_batch_type" jdbcType="INTEGER" property="tBatchType" />
    <result column="t_status" jdbcType="INTEGER" property="tStatus" />
    <result column="t_send_time" jdbcType="TIMESTAMP" property="tSendTime" />
    <result column="t_send_content" jdbcType="VARCHAR" property="tSendContent" />
    <result column="t_sale_id" jdbcType="INTEGER" property="tSaleId" />
    <result column="t_send_email_tatus" jdbcType="INTEGER" property="tSendEmailTatus" />
    <result column="t_send_mail_time" jdbcType="TIMESTAMP" property="tSendMailTime" />
    <result column="saleUserName" jdbcType="VARCHAR" property="saleUserName" />
    <result column="saleEmail" jdbcType="VARCHAR" property="saleEmail" />
    <result column="t_type" jdbcType="INTEGER" property="tType" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    t_id, t_user_id, t_user_name, t_user_sex, t_user_telphone, t_user_email, t_logistics, 
    t_logistics_number, t_batch_id, t_batch_topic, t_batch_type, t_status, t_send_time, 
    t_send_content, t_sale_id, t_send_email_tatus, t_send_mail_time,t_type
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_sort_message
    where t_id = #{tId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from t_sort_message
    where t_id = #{tId,jdbcType=INTEGER}
  </delete>
  
   <delete id="deleteBatchType" parameterType="com.letu.healthplatform.platformmanage.report.model.SortMessage">
    delete from t_sort_message 
    where 1=1 
      and   t_batch_id = #{tBatchId,jdbcType=INTEGER}
      and   t_user_id = #{tUserId,jdbcType=INTEGER}
      and   t_batch_type = #{tBatchType,jdbcType=INTEGER}
  </delete>
  
  
  <insert id="insert" parameterType="com.letu.healthplatform.platformmanage.report.model.SortMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    insert into t_sort_message (t_id, t_user_id, t_user_name, 
      t_user_sex, t_user_telphone, t_user_email, 
      t_logistics, t_logistics_number, t_batch_id, 
      t_batch_topic, t_batch_type, t_status, 
      t_send_time, t_send_content, t_sale_id, 
      t_send_email_tatus, t_send_mail_time,t_type)
    values (#{tId,jdbcType=INTEGER}, #{tUserId,jdbcType=INTEGER}, #{tUserName,jdbcType=VARCHAR}, 
      #{tUserSex,jdbcType=VARCHAR}, #{tUserTelphone,jdbcType=VARCHAR}, #{tUserEmail,jdbcType=VARCHAR}, 
      #{tLogistics,jdbcType=VARCHAR}, #{tLogisticsNumber,jdbcType=VARCHAR}, #{tBatchId,jdbcType=INTEGER}, 
      #{tBatchTopic,jdbcType=VARCHAR}, #{tBatchType,jdbcType=INTEGER}, #{tStatus,jdbcType=INTEGER}, 
      #{tSendTime,jdbcType=TIMESTAMP}, #{tSendContent,jdbcType=VARCHAR}, #{tSaleId,jdbcType=INTEGER}, 
      #{tSendEmailTatus,jdbcType=INTEGER}, #{tSendMailTime,jdbcType=TIMESTAMP}, #{tType,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.letu.healthplatform.platformmanage.report.model.SortMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    insert into t_sort_message
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="tId != null">
        t_id,
      </if>
      <if test="tUserId != null">
        t_user_id,
      </if>
      <if test="tUserName != null">
        t_user_name,
      </if>
      <if test="tUserSex != null">
        t_user_sex,
      </if>
      <if test="tUserTelphone != null">
        t_user_telphone,
      </if>
      <if test="tUserEmail != null">
        t_user_email,
      </if>
      <if test="tLogistics != null">
        t_logistics,
      </if>
      <if test="tLogisticsNumber != null">
        t_logistics_number,
      </if>
      <if test="tBatchId != null">
        t_batch_id,
      </if>
      <if test="tBatchTopic != null">
        t_batch_topic,
      </if>
      <if test="tBatchType != null">
        t_batch_type,
      </if>
      <if test="tStatus != null">
        t_status,
      </if>
      <if test="tSendTime != null">
        t_send_time,
      </if>
      <if test="tSendContent != null">
        t_send_content,
      </if>
      <if test="tSaleId != null">
        t_sale_id,
      </if>
      <if test="tSendEmailTatus != null">
        t_send_email_tatus,
      </if>
      <if test="tSendMailTime != null">
        t_send_mail_time,
      </if>
      <if test="tType != null">
        t_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="tId != null">
        #{tId,jdbcType=INTEGER},
      </if>
      <if test="tUserId != null">
        #{tUserId,jdbcType=INTEGER},
      </if>
      <if test="tUserName != null">
        #{tUserName,jdbcType=VARCHAR},
      </if>
      <if test="tUserSex != null">
        #{tUserSex,jdbcType=VARCHAR},
      </if>
      <if test="tUserTelphone != null">
        #{tUserTelphone,jdbcType=VARCHAR},
      </if>
      <if test="tUserEmail != null">
        #{tUserEmail,jdbcType=VARCHAR},
      </if>
      <if test="tLogistics != null">
        #{tLogistics,jdbcType=VARCHAR},
      </if>
      <if test="tLogisticsNumber != null">
        #{tLogisticsNumber,jdbcType=VARCHAR},
      </if>
      <if test="tBatchId != null">
        #{tBatchId,jdbcType=INTEGER},
      </if>
      <if test="tBatchTopic != null">
        #{tBatchTopic,jdbcType=VARCHAR},
      </if>
      <if test="tBatchType != null">
        #{tBatchType,jdbcType=INTEGER},
      </if>
      <if test="tStatus != null">
        #{tStatus,jdbcType=INTEGER},
      </if>
      <if test="tSendTime != null">
        #{tSendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="tSendContent != null">
        #{tSendContent,jdbcType=VARCHAR},
      </if>
      <if test="tSaleId != null">
        #{tSaleId,jdbcType=INTEGER},
      </if>
      <if test="tSendEmailTatus != null">
        #{tSendEmailTatus,jdbcType=INTEGER},
      </if>
      <if test="tSendMailTime != null">
        #{tSendMailTime,jdbcType=TIMESTAMP},
      </if>
      <if test="tType != null">
        #{tType,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.letu.healthplatform.platformmanage.report.model.SortMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    update t_sort_message
    <set>
      <if test="tUserId != null">
        t_user_id = #{tUserId,jdbcType=INTEGER},
      </if>
      <if test="tUserName != null">
        t_user_name = #{tUserName,jdbcType=VARCHAR},
      </if>
      <if test="tUserSex != null">
        t_user_sex = #{tUserSex,jdbcType=VARCHAR},
      </if>
      <if test="tUserTelphone != null">
        t_user_telphone = #{tUserTelphone,jdbcType=VARCHAR},
      </if>
      <if test="tUserEmail != null">
        t_user_email = #{tUserEmail,jdbcType=VARCHAR},
      </if>
      <if test="tLogistics != null">
        t_logistics = #{tLogistics,jdbcType=VARCHAR},
      </if>
      <if test="tLogisticsNumber != null">
        t_logistics_number = #{tLogisticsNumber,jdbcType=VARCHAR},
      </if>
      <if test="tBatchId != null">
        t_batch_id = #{tBatchId,jdbcType=INTEGER},
      </if>
      <if test="tBatchTopic != null">
        t_batch_topic = #{tBatchTopic,jdbcType=VARCHAR},
      </if>
      <if test="tBatchType != null">
        t_batch_type = #{tBatchType,jdbcType=INTEGER},
      </if>
      <if test="tStatus != null">
        t_status = #{tStatus,jdbcType=INTEGER},
      </if>
      <if test="tSendTime != null">
        t_send_time = #{tSendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="tSendContent != null">
        t_send_content = #{tSendContent,jdbcType=VARCHAR},
      </if>
      <if test="tSaleId != null">
        t_sale_id = #{tSaleId,jdbcType=INTEGER},
      </if>
      <if test="tSendEmailTatus != null">
        t_send_email_tatus = #{tSendEmailTatus,jdbcType=INTEGER},
      </if>
      <if test="tSendMailTime != null">
        t_send_mail_time = #{tSendMailTime,jdbcType=TIMESTAMP},
      </if>
      <if test="tType != null">
        t_type = #{tType,jdbcType=TIMESTAMP},
      </if>
    </set>
    where t_id = #{tId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.letu.healthplatform.platformmanage.report.model.SortMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 24 10:00:47 CST 2018.
    -->
    update t_sort_message
    set t_user_id = #{tUserId,jdbcType=INTEGER},
      t_user_name = #{tUserName,jdbcType=VARCHAR},
      t_user_sex = #{tUserSex,jdbcType=VARCHAR},
      t_user_telphone = #{tUserTelphone,jdbcType=VARCHAR},
      t_user_email = #{tUserEmail,jdbcType=VARCHAR},
      t_logistics = #{tLogistics,jdbcType=VARCHAR},
      t_logistics_number = #{tLogisticsNumber,jdbcType=VARCHAR},
      t_batch_id = #{tBatchId,jdbcType=INTEGER},
      t_batch_topic = #{tBatchTopic,jdbcType=VARCHAR},
      t_batch_type = #{tBatchType,jdbcType=INTEGER},
      t_status = #{tStatus,jdbcType=INTEGER},
      t_send_time = #{tSendTime,jdbcType=TIMESTAMP},
      t_send_content = #{tSendContent,jdbcType=VARCHAR},
      t_sale_id = #{tSaleId,jdbcType=INTEGER},
      t_send_email_tatus = #{tSendEmailTatus,jdbcType=INTEGER},
      t_send_mail_time = #{tSendMailTime,jdbcType=TIMESTAMP}
      t_type = #{tType,jdbcType=INTEGER},
    where t_id = #{tId,jdbcType=INTEGER}
  </update>
  
  
   <select id="selectByParam" parameterType="com.letu.healthplatform.platformmanage.report.model.SortMessage" resultMap="BaseResultMap">
  SELECT  t.*,tl.t_user_name AS saleUserName,tl.t_email saleEmail FROM t_sort_message 
      t LEFT JOIN t_m_login  tl ON t.t_sale_id=tl.t_id
    WHERE 1=1  
      <if test="tId != null">
      and  t.t_id = #{tId,jdbcType=INTEGER}
      </if>
      <if test="tUserId != null">
        and   t.t_user_id = #{tUserId,jdbcType=INTEGER}
      </if>
      <if test="tUserName != null">
        and   t.t_user_name = #{tUserName,jdbcType=VARCHAR}
      </if>
      <if test="tUserSex != null">
        and   t.t_user_sex = #{tUserSex,jdbcType=VARCHAR}
      </if>
      <if test="tUserTelphone != null">
       and    t.t_user_telphone = #{tUserTelphone,jdbcType=VARCHAR}
      </if>
      <if test="tUserEmail != null">
        and   t.t_user_email = #{tUserEmail,jdbcType=VARCHAR}
      </if>
      <if test="tLogistics != null">
        and   t.t_logistics = #{tLogistics,jdbcType=VARCHAR}
      </if>
      <if test="tLogisticsNumber != null">
        and   t.t_logistics_number = #{tLogisticsNumber,jdbcType=VARCHAR}
      </if>
      <if test="tBatchId != null">
        and   t.t_batch_id = #{tBatchId,jdbcType=INTEGER}
      </if>
      <if test="tBatchTopic != null">
        and   t.t_batch_topic = #{tBatchTopic,jdbcType=VARCHAR}
      </if>
      <if test="tBatchType != null">
        and   t.t_batch_type = #{tBatchType,jdbcType=INTEGER}
      </if>
      <if test="tStatus != null">
        and   t.t_status = #{tStatus,jdbcType=INTEGER}
      </if>
      <if test="tSendTime != null">
       and    t.t_send_time = #{tSendTime,jdbcType=TIMESTAMP}
      </if>
      <if test="tType != null">
       and    t.t_type = #{tType,jdbcType=INTEGER}
      </if>
      <if test="tSendContent != null">
        and   t.t_send_content = #{tSendContent,jdbcType=VARCHAR}
      </if>
      <if test="tSaleId != null">
        and   t.t_sale_id = #{tSaleId,jdbcType=INTEGER}
      </if>
      <if test="tSendEmailTatus != null">
        and   t.t_send_email_tatus = #{tSendEmailTatus,jdbcType=INTEGER}
      </if>
      <if test="tSendMailTime != null">
        and   t.t_send_mail_time = #{tSendMailTime,jdbcType=TIMESTAMP}
      </if>
      <if test="saleUserName != null">
        and   tl.t_user_name = #{saleUserName,jdbcType=TIMESTAMP}
      </if>
      <if test="saleEmail != null">
        and   tl.t_email = #{saleEmail,jdbcType=TIMESTAMP}
      </if>
        order by t.t_create_time desc
      
  </select>
   <select id="selectbyIds" parameterType="java.lang.String" resultMap="BaseResultMap">
 
    select 
    <include refid="Base_Column_List" />
    from t_sort_message
    where 1=1  and t_status=0  
      <if test="ids != null">
       and t_id in (${ids} )
		
      </if>
  </select>
  
  
    <!-- 邮件查询信息 -->
   <select id="selectbyBatchIds" parameterType="java.lang.String" resultType="map">
	    SELECT
		  tuser.user_name       AS tUserName,
		  tuser.user_sex        AS tUserSex,
		  tuser.user_telephone  AS tUserTelphone,
		  CASE WHEN tu.t_logistics  IS NULL  THEN  '顺丰快递'
	      ELSE tu.t_logistics  END   AS tLogistics,
		  tu.t_logistics_number AS tLogisticsNumber,
		  tu.t_report_status    AS tReportStatus,
		  ts.t_si_id            AS tBatchId,
		  ts.t_sale_id          AS tSaleId,
		  ts.t_si_source        AS tSiSource,
		  ts.t_si_number        AS tNumber,
		  tu.t_si_project       AS tSampleItem,
		  DATE_FORMAT(tu.t_report_time,'%Y-%m-%d')  AS tReportTime,
		  DATE_FORMAT(ts.t_si_create_date,'%Y-%m-%d')  AS sampleTime,
		  DATE_FORMAT(tu.t_testing_time,'%Y-%m-%d')   AS tTestingTime,
		  tl.t_user_name        AS tSaleName,
		  tl.t_telephone        AS tTelephone,
		  tl.t_email            AS tSaleEmail,
		  tl.t_superior_email   AS tSaleSuperiorEamil,
		  ts.t_si_area          AS tSiArea,
		  tu.t_come_number      AS tSampleNumber
		FROM t_sample_information ts
		  INNER JOIN t_si_user tu
		    ON ts.t_si_id = tu.t_si_id
		  INNER JOIN t_user tuser
		    ON tu.t_user_id = tuser.user_id
		  LEFT JOIN t_m_login tl
		    ON ts.t_sale_id = tl.t_id
		WHERE 1 = 1
      <if test="batchIds != null">
       and ts.t_si_id in (${batchIds} )
      </if>
      and  tu.t_logistics_number is not null
       ORDER BY ts.t_si_create_time , ts.t_si_source   DESC 	
  </select>

  
    <select id="queryByParam" parameterType="map" resultType="map">
        SELECT
		  ts.t_si_source  AS  tSiSource,
		  tuser.user_name       AS tUserName,
		  tuser.user_sex        AS tUserSex,
		  tuser.user_telephone  AS tUserTelphone,
		  tu.t_logistics        AS tLogistics,
		  tu.t_logistics_number AS tLogisticsNumber,
		  tu.t_report_status    AS tReportStatus,
		  ts.t_si_id            AS tBatchId,
		  ts.t_si_sample_batch  AS tBatchName,
		  tu.t_si_project       AS tSampleItem,
		  DATE_FORMAT(tu.t_report_time,"%Y-%m-%d") AS tReportTime,
		  DATE_FORMAT(ts.t_si_create_date,"%Y-%m-%d")  AS sampleTime,
		  DATE_FORMAT(tu.t_testing_time,"%Y-%m-%d") AS tTestingTime,
		  tl.t_user_name        AS tSaleName,
		  tl.t_telephone        AS tTelephone,
		  tl.t_email            AS tEmail,
		  ts.t_si_area          AS tSiArea,
		  tu.t_come_number      AS tSampleNumber
		FROM t_sample_information ts
		  INNER JOIN t_si_user tu
		    ON ts.t_si_id = tu.t_si_id
		  INNER JOIN t_user tuser
		    ON tu.t_user_id = tuser.user_id
		  LEFT JOIN t_m_login tl
		    ON ts.t_sale_id = tl.t_id
		WHERE 1 = 1
      <if test="tUserName != null">
       and tuser.user_name  like CONCAT('%', #{tUserName}, '%')
      </if>
      <if test="tBatchName != null">
       and ts.t_si_sample_batch like CONCAT('%', #{tBatchName}, '%')
      </if>

      <if test="tSaleName != null">
       and tl.t_user_name  like CONCAT('%', #{tSaleName}, '%')
      </if>
       ORDER BY ts.t_si_create_time , ts.t_si_number  DESC 	
  </select>
  
  
   <select id="queryExportParam" parameterType="map" resultType="map">
		 SELECT  
	        CASE WHEN ts.t_si_label  = '1' THEN '个人' 
	        WHEN ts.t_si_label  = '2' THEN '团体'
	        ELSE '' END   AS tSiLable,	
	        ts.t_si_area AS tSiArea,
	        ts.t_si_source AS tSiSource,
	        tu.t_come_number AS tComeNumber,
	        tuser.user_name AS tUserName,
			tuser.user_sex AS tUserSex,
			tuser.user_telephone AS tUserTelphone,
			DATE_FORMAT(tu.t_testing_time,"%Y-%m-%d") AS tTestingTime,
			tu.t_si_project AS tSiProject,
			 ts.t_si_number  AS tSiNumber,
			tl.t_user_name AS tSaleName,
			DATE_FORMAT(tu.t_report_time,"%Y-%m-%d") AS tReportTime,
			tu.t_logistics_number AS tLogisticsNumber ,
			tl.t_telephone AS tTelephone
			FROM t_sample_information ts INNER JOIN t_si_user tu ON
			ts.t_si_id=tu.t_si_id
			INNER JOIN t_user tuser ON tu.t_user_id=tuser.user_id LEFT JOIN t_m_login tl
			ON ts.t_sale_id=tl.t_id
		WHERE 1=1
      <if test="tUserName != null">
       and tuser.user_name  like CONCAT('%', #{tUserName}, '%')
      </if>
      <if test="tBatchName != null">
       and ts.t_si_sample_batch like CONCAT('%', #{tBatchName}, '%')
      </if>

      <if test="tSaleName != null">
       and tl.t_user_name  like CONCAT('%', #{tSaleName}, '%')
      </if>
       ORDER BY ts.t_si_create_time  DESC 	
  </select>
  
  
  
  <update id="updateBatchMessage" parameterType="map">
    update t_sort_message
    set 
      t_status = #{tStatus} , t_send_time=CURRENT_TIMESTAMP
    where t_id in (${ids})
  </update>
  
   <update id="updateEmailStatus" parameterType="java.lang.String">
    update t_sort_message
    set 
      t_send_email_tatus = 1  , t_send_mail_time=CURRENT_TIMESTAMP
    where t_batch_id in (${batchIds})
  </update>
  
</mapper>